transactions:
  # 1. 创建新数据库
  - name: create_new_database
    steps:
      - action: create_database
        database_name: "cms.db"
  # 1. 创建基础表结构
  - name: create_base_tables
    steps:
      # 用户表
      - action: create_table
        table_name: users
        columns:
          - name: id
            type: integer
            primary_key: true
          - name: username
            type: string
            length: 50
            nullable: false
            unique: true
          - name: email
            type: string
            length: 100
            nullable: false
            unique: true
          - name: password_hash
            type: string
            length: 255
            nullable: false
          - name: display_name
            type: string
            length: 100
          - name: avatar_url
            type: string
            length: 255
          - name: bio
            type: text
          - name: role
            type: string
            length: 20
            default: "user"  # user, editor, admin
          - name: status
            type: string
            length: 20
            default: "active"  # active, suspended, deleted
          - name: email_verified
            type: boolean
            default: false
          - name: created_at
            type: datetime
            nullable: false
          - name: updated_at
            type: datetime
            nullable: false
          - name: last_login_at
            type: datetime

      # 分类表
      - action: create_table
        table_name: categories
        columns:
          - name: id
            type: integer
            primary_key: true
          - name: name
            type: string
            length: 50
            nullable: false
          - name: slug
            type: string
            length: 50
            nullable: false
            unique: true
          - name: description
            type: text
          - name: parent_id
            type: integer
            foreign_key:
              table_name: categories
              column: id
          - name: featured_image
            type: string
            length: 255
          - name: sort_order
            type: integer
            default: 0
          - name: created_at
            type: datetime
            nullable: false
          - name: updated_at
            type: datetime
            nullable: false

      # 标签表
      - action: create_table
        table_name: tags
        columns:
          - name: id
            type: integer
            primary_key: true
          - name: name
            type: string
            length: 50
            nullable: false
          - name: slug
            type: string
            length: 50
            nullable: false
            unique: true
          - name: description
            type: text
          - name: created_at
            type: datetime
            nullable: false

      # 文章表
      - action: create_table
        table_name: posts
        columns:
          - name: id
            type: integer
            primary_key: true
          - name: title
            type: string
            length: 200
            nullable: false
          - name: slug
            type: string
            length: 200
            nullable: false
            unique: true
          - name: content
            type: text
            nullable: false
          - name: excerpt
            type: text
          - name: featured_image
            type: string
            length: 255
          - name: author_id
            type: integer
            foreign_key:
              table_name: users
              column: id
          - name: category_id
            type: integer
            foreign_key:
              table_name: categories
              column: id
          - name: status
            type: string
            length: 20
            default: "draft"  # draft, published, archived
          - name: visibility
            type: string
            length: 20
            default: "public"  # public, private, password_protected
          - name: password
            type: string
            length: 255
          - name: published_at
            type: datetime
          - name: created_at
            type: datetime
            nullable: false
          - name: updated_at
            type: datetime
            nullable: false
          - name: views_count
            type: integer
            default: 0
          - name: likes_count
            type: integer
            default: 0
          - name: comments_enabled
            type: boolean
            default: true

      # 文章-标签关联表
      - action: create_table
        table_name: post_tags
        columns:
          - name: post_id
            type: integer
            foreign_key:
              table_name: posts
              column: id
          - name: tag_id
            type: integer
            foreign_key:
              table_name: tags
              column: id
          - name: created_at
            type: datetime
            nullable: false

      # 评论表
      - action: create_table
        table_name: comments
        columns:
          - name: id
            type: integer
            primary_key: true
          - name: post_id
            type: integer
            foreign_key:
              table_name: posts
              column: id
          - name: user_id
            type: integer
            foreign_key:
              table_name: users
              column: id
          - name: parent_id
            type: integer
            foreign_key:
              table_name: comments
              column: id
          - name: content
            type: text
            nullable: false
          - name: status
            type: string
            length: 20
            default: "pending"  # pending, approved, spam
          - name: created_at
            type: datetime
            nullable: false
          - name: updated_at
            type: datetime
            nullable: false
          - name: likes_count
            type: integer
            default: 0

      # 媒体库表
      - action: create_table
        table_name: media
        columns:
          - name: id
            type: integer
            primary_key: true
          - name: file_name
            type: string
            length: 255
            nullable: false
          - name: file_type
            type: string
            length: 50
            nullable: false
          - name: file_size
            type: integer
            nullable: false
          - name: file_path
            type: string
            length: 255
            nullable: false
          - name: uploaded_by
            type: integer
            foreign_key:
              table_name: users
              column: id
          - name: title
            type: string
            length: 255
          - name: description
            type: text
          - name: alt_text
            type: string
            length: 255
          - name: created_at
            type: datetime
            nullable: false
          - name: updated_at
            type: datetime
            nullable: false

      # SEO元数据表
      - action: create_table
        table_name: seo_metadata
        columns:
          - name: id
            type: integer
            primary_key: true
          - name: post_id
            type: integer
            foreign_key:
              table_name: posts
              column: id
          - name: meta_title
            type: string
            length: 200
          - name: meta_description
            type: text
          - name: meta_keywords
            type: text
          - name: og_title
            type: string
            length: 200
          - name: og_description
            type: text
          - name: og_image
            type: string
            length: 255
          - name: created_at
            type: datetime
            nullable: false
          - name: updated_at
            type: datetime
            nullable: false

  # 2. 初始化基础数据
  - name: initialize_base_data
    steps:
      # 创建管理员用户
      - action: insert
        table_name: users
        values:
          username: "admin"
          email: "admin@example.com"
          password_hash: "{{ hashed_password }}"
          display_name: "Administrator"
          role: "admin"
          status: "active"
          # email_verified: true
          created_at: "{{ current_timestamp }}"
          updated_at: "{{ current_timestamp }}"

      # 创建默认分类
      - action: insert
        table_name: categories
        values:
          name: "未分类"
          slug: "uncategorized"
          description: "默认分类"
          created_at: "{{ current_timestamp }}"
          updated_at: "{{ current_timestamp }}"

  # 3. 创建文章
  - name: create_post
    steps:
      # # 上传特色图片
      # - action: upload_file
      #   folder_path: "uploads/images"
      #   file_name: "{{ file_name }}"
      #   file: "{{ featured_image }}"
      #   data_to: image_upload

      # 创建文章
      - action: insert
        table_name: posts
        values:
          title: "{{ title }}"
          slug: "{{ slug }}"
          content: "{{ content }}"
          excerpt: "{{ excerpt }}"
          featured_image: "{{ image_upload.destination }}"
          author_id: "{{ current_user_id }}"
          category_id: "{{ category_id }}"
          status: "{{ status }}"
          visibility: "{{ visibility }}"
          published_at: "{{ published_at }}"
          created_at: "{{ current_timestamp }}"
          updated_at: "{{ current_timestamp }}"
        data_to: new_post

      # # 添加标签
      # - action: for_each
      #   data_from: "{{ tags }}"
      #   steps:
      #     - action: insert
      #       table_name: post_tags
      #       values:
      #         post_id: "{{ new_post.id }}"
      #         tag_id: "{{ item }}"
      #         created_at: "{{ current_timestamp }}"

      # # 添加SEO信息
      # - action: insert
      #   table_name: seo_metadata
      #   values:
      #     post_id: "{{ new_post.id }}"
      #     meta_title: "{{ meta_title }}"
      #     meta_description: "{{ meta_description }}"
      #     meta_keywords: "{{ meta_keywords }}"
      #     created_at: "{{ current_timestamp }}"
      #     updated_at: "{{ current_timestamp }}"

  - name: delete_post
    steps:
      - action: delete
        table_name: posts
        filter_values:
          - field: id
            operator: eq
            value: "{{ id }}"

  # 4. 获取文章列表
  - name: get_posts_list
    steps:
      - action: get
        table_name: posts
        fields:
          - field: id
          - field: title
          - field: slug
          - field: content
          - field: excerpt
          - field: featured_image
          - field: status
          - field: published_at
          - field: views_count
          # - field: comments_enabled
          # - table_name: users
          #   field: display_name
          #   label: author_name
          # - table_name: categories
          #   field: name
          #   label: category_name
        # join:
        #   - left_table_name: posts
        #     right_table_name: users
        #     type: left
        #     on:
        #       - left_column: author_id
        #         right_column: id
        #   - left_table_name: posts
        #     right_table_name: categories
        #     type: left
        #     on:
        #       - left_column: category_id
        #         right_column: id
        # filter_values:
        #   - field: status
        #     operator: eq
        #     value: "published"
        order_by:
          - field: id
            direction: desc
        limit: "{{ limit }}"
        offset: "{{ offset }}"
        # limit: 5
        # offset: 5
        
  # 5. 获取文章详情
  - name: get_post_detail
    steps:
      # 获取文章基本信息
      - action: get
        table_name: posts
        fields:
          # - field: "*"
          - field: id
          - field: title
          - field: slug
          - field: content
          - field: excerpt
          - field: featured_image
          - field: status
          - field: published_at
          - field: views_count
          # - table_name: users
          #   field: display_name
          #   label: author_name
        #   - table_name: users
        #     field: avatar_url
        #     label: author_avatar
        #   - table_name: categories
        #     field: name
        #     label: category_name
        #   - table_name: categories
        #     field: slug
        #     label: category_slug
        # join:
        #   - left_table_name: posts
        #     right_table_name: users
        #     type: left
        #     on:
        #       - left_column: author_id
        #         right_column: id
        #   - left_table_name: posts
        #     right_table_name: categories
        #     type: left
        #     on:
        #       - left_column: category_id
        #         right_column: id
        # filter_values:
        #   - field: slug
        #     operator: eq
        #     value: "{{ post_slug }}"
        filter_values:
          - field: id
            operator: eq
            value: "{{ post_id }}"
        data_to: post_info

      # 获取文章标签
      - action: get
        table_name: tags
        fields:
          - field: name
          - field: slug
        join:
          - left_table_name: tags
            right_table_name: post_tags
            type: inner
            on:
              - left_column: id
                right_column: tag_id
        filter_values:
          - field: post_id
            operator: eq
            value: "{{ post_info[0].id }}"
        data_to: post_tags

      # 获取评论
      - action: get
        table_name: comments
        fields:
          - field: id
          - field: content
          - field: created_at
          - field: parent_id
          - field: likes_count
          - table_name: users
            field: display_name
            label: user_name
          - table_name: users
            field: avatar_url
            label: user_avatar
        join:
          - left_table_name: comments
            right_table_name: users
            type: left
            on:
              - left_column: user_id
                right_column: id
        filter_values:
          - field: post_id
            operator: eq
            value: "{{ post_info[0].id }}"
          - field: status
            operator: eq
            value: "approved"
        order_by:
          - field: created_at
            direction: desc
        data_to: comments

      # 更新浏览次数
      - action: execute
        sql: "UPDATE posts SET views_count = views_count + 1 WHERE id = {{ post_info[0].id }}"

  # 6. 添加评论
  - name: add_comment
    steps:
      - action: insert
        table_name: comments
        values:
          post_id: "{{ post_id }}"
          user_id: "{{ current_user_id }}"
          parent_id: "{{ parent_id }}"
          content: "{{ content }}"
          status: "{{ status }}"
          created_at: "{{ current_timestamp }}"
          updated_at: "{{ current_timestamp }}"

  # 7. 获取分类列表（带文章计数）
  - name: get_categories_with_count
    steps:
      - action: get
        table_name: categories
        fields:
          - field: id
          - field: name
          - field: slug
          - field: description
          - field: parent_id
          - field: featured_image
          - field: id
            function: count
            label: post_count
            table_name: posts
        join:
          - left_table_name: categories
            right_table_name: posts
            type: left
            on:
              - left_column: id
                right_column: category_id
        group_by:
          - field: id
          - field: name
          - field: slug
          - field: description
          - field: parent_id
          - field: featured_image
        order_by:
          - field: sort_order
            direction: asc
          - field: name
            direction: asc


  # # 1. 创建基础表结构
  # - name: create_base_tables
  #   steps:
  #     # 用户表
  #     - action: create_table
  #       table_name: users
  #       columns:
  #         - name: id
  #           type: integer
  #           primary_key: true
  #         - name: username
  #           type: string
  #           length: 50
  #           nullable: false
  #           unique: true
  #         - name: email
  #           type: string
  #           length: 100
  #           nullable: false
  #           unique: true
  #         - name: password_hash
  #           type: string
  #           length: 255
  #           nullable: false
  #         - name: display_name
  #           type: string
  #           length: 100
  #         - name: avatar_url
  #           type: string
  #           length: 255
  #         - name: bio
  #           type: text
  #         - name: role
  #           type: string
  #           length: 20
  #           default: "user"  # user, editor, admin
  #         - name: status
  #           type: string
  #           length: 20
  #           default: "active"  # active, suspended, deleted
  #         - name: email_verified
  #           type: boolean
  #           default: false
  #         - name: created_at
  #           type: datetime
  #           nullable: false
  #         - name: updated_at
  #           type: datetime
  #           nullable: false
  #         - name: last_login_at
  #           type: datetime

  #     # 分类表
  #     - action: create_table
  #       table_name: categories
  #       columns:
  #         - name: id
  #           type: integer
  #           primary_key: true
  #         - name: name
  #           type: string
  #           length: 50
  #           nullable: false
  #         - name: slug
  #           type: string
  #           length: 50
  #           nullable: false
  #           unique: true
  #         - name: description
  #           type: text
  #         - name: parent_id
  #           type: integer
  #           foreign_key:
  #             table_name: categories
  #             column: id
  #         - name: featured_image
  #           type: string
  #           length: 255
  #         - name: sort_order
  #           type: integer
  #           default: 0
  #         - name: created_at
  #           type: datetime
  #           nullable: false
  #         - name: updated_at
  #           type: datetime
  #           nullable: false

  #     # 标签表
  #     - action: create_table
  #       table_name: tags
  #       columns:
  #         - name: id
  #           type: integer
  #           primary_key: true
  #         - name: name
  #           type: string
  #           length: 50
  #           nullable: false
  #         - name: slug
  #           type: string
  #           length: 50
  #           nullable: false
  #           unique: true
  #         - name: description
  #           type: text
  #         - name: created_at
  #           type: datetime
  #           nullable: false

  #     # 文章表
  #     - action: create_table
  #       table_name: posts
  #       columns:
  #         - name: id
  #           type: integer
  #           primary_key: true
  #         - name: title
  #           type: string
  #           length: 200
  #           nullable: false
  #         - name: slug
  #           type: string
  #           length: 200
  #           nullable: false
  #           unique: true
  #         - name: content
  #           type: text
  #           nullable: false
  #         - name: excerpt
  #           type: text
  #         - name: featured_image
  #           type: string
  #           length: 255
  #         - name: author_id
  #           type: integer
  #           foreign_key:
  #             table_name: users
  #             column: id
  #         - name: category_id
  #           type: integer
  #           foreign_key:
  #             table_name: categories
  #             column: id
  #         - name: status
  #           type: string
  #           length: 20
  #           default: "draft"  # draft, published, archived
  #         - name: visibility
  #           type: string
  #           length: 20
  #           default: "public"  # public, private, password_protected
  #         - name: password
  #           type: string
  #           length: 255
  #         - name: published_at
  #           type: datetime
  #         - name: created_at
  #           type: datetime
  #           nullable: false
  #         - name: updated_at
  #           type: datetime
  #           nullable: false
  #         - name: views_count
  #           type: integer
  #           default: 0
  #         - name: likes_count
  #           type: integer
  #           default: 0
  #         - name: comments_enabled
  #           type: boolean
  #           default: true

  #     # 文章-标签关联表
  #     - action: create_table
  #       table_name: post_tags
  #       columns:
  #         - name: post_id
  #           type: integer
  #           foreign_key:
  #             table_name: posts
  #             column: id
  #         - name: tag_id
  #           type: integer
  #           foreign_key:
  #             table_name: tags
  #             column: id
  #         - name: created_at
  #           type: datetime
  #           nullable: false

  #     # 评论表
  #     - action: create_table
  #       table_name: comments
  #       columns:
  #         - name: id
  #           type: integer
  #           primary_key: true
  #         - name: post_id
  #           type: integer
  #           foreign_key:
  #             table_name: posts
  #             column: id
  #         - name: user_id
  #           type: integer
  #           foreign_key:
  #             table_name: users
  #             column: id
  #         - name: parent_id
  #           type: integer
  #           foreign_key:
  #             table_name: comments
  #             column: id
  #         - name: content
  #           type: text
  #           nullable: false
  #         - name: status
  #           type: string
  #           length: 20
  #           default: "pending"  # pending, approved, spam
  #         - name: created_at
  #           type: datetime
  #           nullable: false
  #         - name: updated_at
  #           type: datetime
  #           nullable: false
  #         - name: likes_count
  #           type: integer
  #           default: 0

  #     # 媒体库表
  #     - action: create_table
  #       table_name: media
  #       columns:
  #         - name: id
  #           type: integer
  #           primary_key: true
  #         - name: file_name
  #           type: string
  #           length: 255
  #           nullable: false
  #         - name: file_type
  #           type: string
  #           length: 50
  #           nullable: false
  #         - name: file_size
  #           type: integer
  #           nullable: false
  #         - name: file_path
  #           type: string
  #           length: 255
  #           nullable: false
  #         - name: uploaded_by
  #           type: integer
  #           foreign_key:
  #             table_name: users
  #             column: id
  #         - name: title
  #           type: string
  #           length: 255
  #         - name: description
  #           type: text
  #         - name: alt_text
  #           type: string
  #           length: 255
  #         - name: created_at
  #           type: datetime
  #           nullable: false
  #         - name: updated_at
  #           type: datetime
  #           nullable: false

  #     # SEO元数据表
  #     - action: create_table
  #       table_name: seo_metadata
  #       columns:
  #         - name: id
  #           type: integer
  #           primary_key: true
  #         - name: post_id
  #           type: integer
  #           foreign_key:
  #             table_name: posts
  #             column: id
  #         - name: meta_title
  #           type: string
  #           length: 200
  #         - name: meta_description
  #           type: text
  #         - name: meta_keywords
  #           type: text
  #         - name: og_title
  #           type: string
  #           length: 200
  #         - name: og_description
  #           type: text
  #         - name: og_image
  #           type: string
  #           length: 255
  #         - name: created_at
  #           type: datetime
  #           nullable: false
  #         - name: updated_at
  #           type: datetime
  #           nullable: false

  # # 2. 初始化基础数据
  # - name: initialize_base_data
  #   steps:
  #     # 创建管理员用户
  #     - action: insert
  #       table_name: users
  #       values:
  #         username: "admin"
  #         email: "admin@example.com"
  #         password_hash: "{{ hashed_password }}"
  #         display_name: "Administrator"
  #         role: "admin"
  #         status: "active"
  #         email_verified: true
  #         created_at: "{{ current_timestamp }}"
  #         updated_at: "{{ current_timestamp }}"

  #     # 创建默认分类
  #     - action: insert
  #       table_name: categories
  #       values:
  #         name: "未分类"
  #         slug: "uncategorized"
  #         description: "默认分类"
  #         created_at: "{{ current_timestamp }}"
  #         updated_at: "{{ current_timestamp }}"

  # # 3. 创建文章
  # - name: create_post
  #   steps:
  #     # 上传特色图片
  #     - action: upload_file
  #       folder_path: "uploads/images"
  #       file_name: "{{ file_name }}"
  #       file: "{{ featured_image }}"
  #       data_to: image_upload

  #     # 创建文章
  #     - action: insert
  #       table_name: posts
  #       values:
  #         title: "{{ title }}"
  #         slug: "{{ slug }}"
  #         content: "{{ content }}"
  #         excerpt: "{{ excerpt }}"
  #         featured_image: "{{ image_upload.destination }}"
  #         author_id: "{{ current_user_id }}"
  #         category_id: "{{ category_id }}"
  #         status: "{{ status }}"
  #         visibility: "{{ visibility }}"
  #         published_at: "{{ published_at }}"
  #         created_at: "{{ current_timestamp }}"
  #         updated_at: "{{ current_timestamp }}"
  #       data_to: new_post

  #     # 添加标签
  #     - action: for_each
  #       data_from: "{{ tags }}"
  #       steps:
  #         - action: insert
  #           table_name: post_tags
  #           values:
  #             post_id: "{{ new_post.id }}"
  #             tag_id: "{{ item }}"
  #             created_at: "{{ current_timestamp }}"

  #     # 添加SEO信息
  #     - action: insert
  #       table_name: seo_metadata
  #       values:
  #         post_id: "{{ new_post.id }}"
  #         meta_title: "{{ meta_title }}"
  #         meta_description: "{{ meta_description }}"
  #         meta_keywords: "{{ meta_keywords }}"
  #         created_at: "{{ current_timestamp }}"
  #         updated_at: "{{ current_timestamp }}"

  # # 4. 获取文章列表
  # - name: get_posts_list
  #   steps:
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: id
  #         - field: title
  #         - field: slug
  #         - field: excerpt
  #         - field: featured_image
  #         - field: status
  #         - field: published_at
  #         - field: views_count
  #         - field: comments_enabled
  #         - table_name: users
  #           field: display_name
  #           label: author_name
  #         - table_name: categories
  #           field: name
  #           label: category_name
  #       join:
  #         - left_table_name: posts
  #           right_table_name: users
  #           type: left
  #           on:
  #             - left_column: author_id
  #               right_column: id
  #         - left_table_name: posts
  #           right_table_name: categories
  #           type: left
  #           on:
  #             - left_column: category_id
  #               right_column: id
  #       filter_values:
  #         - field: status
  #           operator: eq
  #           value: "published"
  #       order_by:
  #         - field: published_at
  #           direction: desc
  #       limit: "{{ page_size }}"
  #       offset: "{{ (page_number - 1) * page_size }}"

  # # 5. 获取文章详情
  # - name: get_post_detail
  #   steps:
  #     # 获取文章基本信息
  #     - action: get
  #       
  
  #       fields:
  #         - field: "*"
  #         - table_name: users
  #           field: display_name
  #           label: author_name
  #         - table_name: users
  #           field: avatar_url
  #           label: author_avatar
  #         - table_name: categories
  #           field: name
  #           label: category_name
  #         - table_name: categories
  #           field: slug
  #           label: category_slug
  #       join:
  #         - left_table_name: posts
  #           right_table_name: users
  #           type: left
  #           on:
  #             - left_column: author_id
  #               right_column: id
  #         - left_table_name: posts
  #           right_table_name: categories
  #           type: left
  #           on:
  #             - left_column: category_id
  #               right_column: id
  #       filter_values:
  #         - field: slug
  #           operator: eq
  #           value: "{{ post_slug }}"
  #       data_to: post_info

  #     # 获取文章标签
  #     - action: get
  #       table_name: tags
  #       fields:
  #         - field: name
  #         - field: slug
  #       join:
  #         - left_table_name: tags
  #           right_table_name: post_tags
  #           type: inner
  #           on:
  #             - left_column: id
  #               right_column: tag_id
  #       filter_values:
  #         - field: post_id
  #           operator: eq
  #           value: "{{ post_info[0].id }}"
  #       data_to: post_tags

  #     # 获取评论
  #     - action: get
  #       table_name: comments
  #       fields:
  #         - field: id
  #         - field: content
  #         - field: created_at
  #         - field: parent_id
  #         - field: likes_count
  #         - table_name: users
  #           field: display_name
  #           label: user_name
  #         - table_name: users
  #           field: avatar_url
  #           label: user_avatar
  #       join:
  #         - left_table_name: comments
  #           right_table_name: users
  #           type: left
  #           on:
  #             - left_column: user_id
  #               right_column: id
  #       filter_values:
  #         - field: post_id
  #           operator: eq
  #           value: "{{ post_info[0].id }}"
  #         - field: status
  #           operator: eq
  #           value: "approved"
  #       order_by:
  #         - field: created_at
  #           direction: desc
  #       data_to: comments

  #     # 更新浏览次数
  #     - action: execute
  #       sql: "UPDATE posts SET views_count = views_count + 1 WHERE id = {{ post_info[0].id }}"

  # # 6. 添加评论
  # - name: add_comment
  #   steps:
  #     - action: insert
  #       table_name: comments
  #       values:
  #         post_id: "{{ post_id }}"
  #         user_id: "{{ current_user_id }}"
  #         parent_id: "{{ parent_id }}"
  #         content: "{{ content }}"
  #         status: "{{ status }}"
  #         created_at: "{{ current_timestamp }}"
  #         updated_at: "{{ current_timestamp }}"

  # # 7. 获取分类列表（带文章计数）
  # - name: get_categories_with_count
  #   steps:
  #     - action: get
  #       table_name: categories
  #       fields:
  #         - field: id
  #         - field: name
  #         - field: slug
  #         - field: description
  #         - field: parent_id
  #         - field: featured_image
  #         - field: id
  #           function: count
  #           label: post_count
  #           table_name: posts
  #       join:
  #         - left_table_name: categories
  #           right_table_name: posts
  #           type: left
  #           on:
  #             - left_column: id
  #               right_column: category_id
  #       group_by:
  #         - field: id
  #         - field: name
  #         - field: slug
  #         - field: description
  #         - field: parent_id
  #         - field: featured_image
  #       order_by:
  #         - field: sort_order
  #           direction: asc
  #         - field: name
  #           direction: asc

  # # 8. 搜索文章
  # - name: search_posts
  #   steps:
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: id
  #         - field: title
  #         - field: slug
  #         - field: excerpt
  #         - field: featured_image
  #         - field: published_at
  #         - table_name: users
  #           field: display_name
  #           label: author_name
  #         - table_name: categories
  #           field: name
  #           label: category_name
  #       join:
  #         - left_table_name: posts
  #           right_table_name: users
  #           type: left
  #           on:
  #             - left_column: author_id
  #               right_column: id
  #         - left_table_name: posts
  #           right_table_name: categories
  #           type: left
  #           on:
  #             - left_column: category_id
  #               right_column: id
  #         # 添加标签关联，用于标签搜索
  #         - left_table_name: posts
  #           right_table_name: post_tags
  #           type: left
  #           on:
  #             - left_column: id
  #               right_column: post_id
  #         - left_table_name: post_tags
  #           right_table_name: tags
  #           type: left
  #           on:
  #             - left_column: tag_id
  #               right_column: id
  #       filter_values:
  #         - type: and
  #           conditions:
  #             - field: status
  #               operator: eq
  #               value: "published"
  #             - type: or
  #               conditions:
  #                 - field: title
  #                   operator: ilike
  #                   value: "%{{ search_term }}%"
  #                 - field: content
  #                   operator: ilike
  #                   value: "%{{ search_term }}%"
  #                 - table_name: tags
  #                   field: name
  #                   operator: ilike
  #                   value: "%{{ search_term }}%"
  #       order_by:
  #         - field: published_at
  #           direction: desc
  #       limit: "{{ page_size }}"
  #       offset: "{{ (page_number - 1) * page_size }}"

  # # 9. 获取标签云
  # - name: get_tag_cloud
  #   steps:
  #     - action: get
  #       table_name: tags
  #       fields:
  #         - field: id
  #         - field: name
  #         - field: slug
  #         - field: id
  #           function: count
  #           label: post_count
  #           table_name: post_tags
  #       join:
  #         - left_table_name: tags
  #           right_table_name: post_tags
  #           type: left
  #           on:
  #             - left_column: id
  #               right_column: tag_id
  #       group_by:
  #         - field: id
  #         - field: name
  #         - field: slug
  #       having:
  #         - field: post_count
  #           operator: gt
  #           value: 0
  #       order_by:
  #         - field: post_count
  #           direction: desc
  #         - field: name
  #           direction: asc

  # # 10. 获取归档数据
  # - name: get_archives
  #   steps:
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: published_at
  #           function: date_trunc
  #           part: month
  #           label: month
  #         - field: id
  #           function: count
  #           label: post_count
  #       filter_values:
  #         - field: status
  #           operator: eq
  #           value: "published"
  #         - field: published_at
  #           operator: is_not_null
  #       group_by:
  #         - field: month
  #       order_by:
  #         - field: month
  #           direction: desc

  # # 11. 用户仪表板统计
  # - name: get_user_dashboard_stats
  #   steps:
  #     # 获取用户文章统计
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: status
  #         - field: id
  #           function: count
  #           label: post_count
  #       filter_values:
  #         - field: author_id
  #           operator: eq
  #           value: "{{ current_user_id }}"
  #       group_by:
  #         - field: status
  #       data_to: post_stats

  #     # 获取用户评论统计
  #     - action: get
  #       table_name: comments
  #       fields:
  #         - field: status
  #         - field: id
  #           function: count
  #           label: comment_count
  #       filter_values:
  #         - field: user_id
  #           operator: eq
  #           value: "{{ current_user_id }}"
  #       group_by:
  #         - field: status
  #       data_to: comment_stats

  #     # 获取最近文章浏览量
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: title
  #         - field: slug
  #         - field: views_count
  #         - field: published_at
  #       filter_values:
  #         - field: author_id
  #           operator: eq
  #           value: "{{ current_user_id }}"
  #         - field: published_at
  #           operator: ge
  #           value: "{{ last_30_days }}"
  #       order_by:
  #         - field: views_count
  #           direction: desc
  #       limit: 5
  #       data_to: popular_posts

  # # 12. 批量操作文章
  # - name: bulk_update_posts
  #   steps:
  #     - action: update
  #       table_name: posts
  #       values:
  #         status: "{{ new_status }}"
  #         updated_at: "{{ current_timestamp }}"
  #       filter_values:
  #         - field: id
  #           operator: in
  #           value: "{{ post_ids }}"

  # # 13. 生成站点地图
  # - name: generate_sitemap
  #   steps:
  #     # 获取所有已发布的文章
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: slug
  #         - field: updated_at
  #       filter_values:
  #         - field: status
  #           operator: eq
  #           value: "published"
  #       data_to: posts

  #     # 获取所有分类
  #     - action: get
  #       table_name: categories
  #       fields:
  #         - field: slug
  #         - field: updated_at
  #       data_to: categories

  #     # 获取所有标签
  #     - action: get
  #       table_name: tags
  #       fields:
  #         - field: slug
  #         - field: id
  #           function: count
  #           label: post_count
  #           table_name: post_tags
  #       join:
  #         - left_table_name: tags
  #           right_table_name: post_tags
  #           type: left
  #           on:
  #             - left_column: id
  #               right_column: tag_id
  #       group_by:
  #         - field: slug
  #       having:
  #         - field: post_count
  #           operator: gt
  #           value: 0
  #       data_to: tags

  #     # 生成 sitemap.xml
  #     - action: file_create
  #       file_name: "sitemap.xml"
  #       content_type: "xml"
  #       data_from: "combined_urls"

  # # 14. 导入文章
  # - name: import_posts
  #   steps:
  #     - action: upload_file
  #       folder_path: "imports"
  #       file_name: "{{ file_name }}"
  #       file: "{{ import_file }}"
  #       data_to: upload_result

  #     # 处理导入的数据
  #     - action: for_each
  #       data_from: "{{ processed_data }}"
  #       steps:
  #         - action: insert
  #           table_name: posts
  #           values:
  #             title: "{{ item.title }}"
  #             slug: "{{ item.slug }}"
  #             content: "{{ item.content }}"
  #             excerpt: "{{ item.excerpt }}"
  #             author_id: "{{ current_user_id }}"
  #             status: "draft"
  #             created_at: "{{ current_timestamp }}"
  #             updated_at: "{{ current_timestamp }}"

  # # 15. 生成 RSS Feed
  # - name: generate_rss_feed
  #   steps:
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: title
  #         - field: slug
  #         - field: excerpt
  #         - field: content
  #         - field: published_at
  #         - field: updated_at
  #         - table_name: users
  #           field: display_name
  #           label: author_name
  #         - table_name: categories
  #           field: name
  #           label: category_name
  #       join:
  #         - left_table_name: posts
  #           right_table_name: users
  #           type: left
  #           on:
  #             - left_column: author_id
  #               right_column: id
  #         - left_table_name: posts
  #           right_table_name: categories
  #           type: left
  #           on:
  #             - left_column: category_id
  #               right_column: id
  #       filter_values:
  #         - field: status
  #           operator: eq
  #           value: "published"
  #       order_by:
  #         - field: published_at
  #           direction: desc
  #       limit: 20
  #       data_to: feed_posts

  #     # 生成 RSS XML
  #     - action: file_create
  #       file_name: "feed.xml"
  #       content_type: "xml"
  #       data_from: "feed_posts"

  # # 16. 统计报告
  # - name: generate_statistics_report
  #   steps:
  #     # 按月统计文章发布数量
  #     - action: get
  #       table_name: posts
  #       fields:
  #         - field: published_at
  #           function: date_trunc
  #           part: month
  #           label: month
  #         - field: id
  #           function: count
  #           label: post_count
  #       filter_values:
  #         - field: status
  #           operator: eq
  #           value: "published"
  #         - field: published_at
  #           operator: between
  #           value: ["{{ report_start_date }}", "{{ report_end_date }}"]
  #       group_by:
  #         - field: month
  #       order_by:
  #         - field: month
  #           direction: asc
  #       data_to: monthly_posts

  #     # 统计热门分类
  #     - action: get
  #       table_name: categories
  #       fields:
  #         - field: name
  #         - field: id
  #           function: count
  #           label: post_count
  #           table_name: posts
  #       join:
  #         - left_table_name: categories
  #           right_table_name: posts
  #           type: left
  #           on:
  #             - left_column: id
  #               right_column: category_id
  #       filter_values:
  #         - field: status
  #           operator: eq
  #           value: "published"
  #         - table_name: posts
  #           field: published_at
  #           operator: between
  #           value: ["{{ report_start_date }}", "{{ report_end_date }}"]
  #       group_by:
  #         - field: name
  #       order_by:
  #         - field: post_count
  #           direction: desc
  #       data_to: category_stats

  #     # 统计热门作者
  #     - action: get
  #       table_name: users
  #       fields:
  #         - field: display_name
  #         - field: id
  #           function: count
  #           label: post_count
  #           table_name: posts
  #         - table_name: posts
  #           field: views_count
  #           function: sum
  #           label: total_views
  #       join:
  #         - left_table_name: users
  #           right_table_name: posts
  #           type: left
  #           on:
  #             - left_column: id
  #               right_column: author_id
  #       filter_values:
  #         - field: status
  #           operator: eq
  #           value: "published"
  #         - table_name: posts
  #           field: published_at
  #           operator: between
  #           value: ["{{ report_start_date }}", "{{ report_end_date }}"]
  #       group_by:
  #         - field: display_name
  #       order_by:
  #         - field: total_views
  #           direction: desc
  #       data_to: author_stats